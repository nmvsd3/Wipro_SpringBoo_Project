<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Task Details</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Inter',sans-serif; background:#f8fafc; color:#334155; line-height:1.6; }

    header { background:linear-gradient(135deg,#1e293b,#334155); color:white; padding:20px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,.1); }
    header h2 { font-size:24px; font-weight:700; }

    .container { display:flex; min-height:calc(100vh - 80px); }
    nav.sidebar { width:250px; background:linear-gradient(180deg,#1e293b,#334155); color:white; padding:20px 0; }
    nav.sidebar a { display:flex; align-items:center; gap:10px; color:#cbd5e1; text-decoration:none; padding:12px 20px; border-radius:8px; transition:.3s; }
    nav.sidebar a:hover { background:rgba(255,255,255,.1); color:white; }
    nav.sidebar a.active { background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; }

    main { flex:1; padding:30px; background:#f8fafc; }
    footer { background:linear-gradient(135deg,#1e293b,#334155); color:#94a3b8; padding:15px; text-align:center; }

    .task-header { background:white; border-radius:20px; padding:30px; margin-bottom:30px; box-shadow:0 4px 20px rgba(0,0,0,.08); }
    .task-title { font-size:28px; font-weight:700; margin-bottom:20px; }
    .task-meta { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-top:20px; }
    .meta-item { background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0; }
    .meta-label { font-size:14px; font-weight:600; color:#64748b; margin-bottom:6px; display:flex; align-items:center; gap:6px; }
    .meta-value { font-size:16px; font-weight:600; color:#1e293b; }

    .status-dropdown { padding:8px 12px; border:1px solid #cbd5e1; border-radius:8px; font-size:14px; font-weight:600; background:white; color:#1e293b; }
    .update-btn { background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:white; border:none; padding:8px 14px; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; }
    .update-btn:hover { background:linear-gradient(135deg,#2563eb,#1e40af); }

    .freeze-btn { background:linear-gradient(135deg,#f59e0b,#b45309); color:white; border:none; padding:8px 14px; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; margin-top:10px; }
    .freeze-btn:hover { background:linear-gradient(135deg,#d97706,#92400e); }

    .delete-btn { background:linear-gradient(135deg,#ef4444,#b91c1c); color:white; border:none; padding:10px 16px; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; margin-top:20px; }
    .delete-btn:hover { background:linear-gradient(135deg,#dc2626,#991b1b); }

    .restore-btn { background:linear-gradient(135deg,#10b981,#059669); color:white; border:none; padding:10px 16px; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; margin-top:20px; }
    .restore-btn:hover { background:linear-gradient(135deg,#059669,#047857); }

    .assignee-badge { display:flex; align-items:center; gap:8px; background:white; border:1px solid #cbd5e1; border-radius:20px; padding:4px 10px; font-size:14px; font-weight:600; }
    .assignee-avatar { width:26px; height:26px; border-radius:50%; background:linear-gradient(135deg,#3b82f6,#8b5cf6); color:white; display:flex; align-items:center; justify-content:center; font-size:12px; }

    .description { background:white; border-radius:20px; padding:20px; margin-bottom:30px; border:1px solid #e2e8f0; }

    .activity-section { background:white; border-radius:20px; padding:20px; border:1px solid #e2e8f0; margin-top:20px; }
    .activity-item { border-left:4px solid #3b82f6; padding:12px 16px; margin-bottom:12px; background:#f8fafc; border-radius:6px; }
    .activity-header { display:flex; justify-content:space-between; font-size:14px; margin-bottom:6px; }
    .author { font-weight:600; color:#1e293b; }
    .activity-time { font-size:12px; color:#64748b; }
    .activity-content { font-size:14px; color:#334155; }
    .no-activities { text-align:center; font-style:italic; color:#94a3b8; }

    .comments-section { background:white; border-radius:20px; padding:20px; border:1px solid #e2e8f0; margin-top:20px; }
    .comment-item { background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px; padding:12px; margin-bottom:12px; }
    .comment-header { display:flex; justify-content:space-between; font-size:14px; margin-bottom:6px; }
    .comment-time { font-size:12px; color:#64748b; }
    .comment-form { margin-top:20px; display:flex; gap:10px; }
    .comment-input { flex:1; padding:10px; border:1px solid #cbd5e1; border-radius:8px; font-size:14px; }
    .comment-btn { background:linear-gradient(135deg,#10b981,#059669); color:white; border:none; padding:10px 16px; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; }
    .comment-btn:hover { background:linear-gradient(135deg,#059669,#047857); }
  </style>
</head>
<body>
<header>
  <h2><i class="fas fa-shield-alt"></i> Admin Panel</h2>
</header>

<div class="container">
  <nav class="sidebar">
    <a th:href="@{/admin/dashboard}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a th:href="@{/admin/manage-task}"><i class="fas fa-tasks"></i> Manage Tasks</a>
    <a th:href="@{/admin/tasks}" class="active"><i class="fas fa-list-check"></i> Tasks</a>
    <a th:href="@{/admin/manage-user}"><i class="fas fa-users-cog"></i> Manage Users</a>
    <a th:href="@{/admin/users}"><i class="fas fa-users"></i> Users</a>
    <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </nav>

  <main>
    <a th:href="@{/admin/tasks}" class="back-button"><i class="fas fa-arrow-left"></i> Back to Tasks</a>

    <!-- Task Info -->
    <div class="task-header">
      <h1 class="task-title" th:text="${task.title}">Task Title</h1>
      <div class="task-meta">
        <!-- Assignees -->
        <div class="meta-item">
          <div class="meta-label"><i class="fas fa-users"></i> Assignees</div>
          <div class="meta-value">
            <span th:each="u : ${task.assignees}" class="assignee-badge">
              <span class="assignee-avatar" th:text="${#strings.substring(u.username,0,1).toUpperCase()}">U</span>
              <span th:text="${u.username}">Username</span>
            </span>
            <span th:if="${task.assignees == null or task.assignees.isEmpty()}"><i class="fas fa-user-slash"></i> Unassigned</span>
          </div>
        </div>

        <!-- Status -->
        <div class="meta-item">
          <div class="meta-label"><i class="fas fa-flag"></i> Status</div>
          <div class="meta-value">
            <form th:action="@{'/admin/tasks/' + ${task.id} + '/status'}" method="post" 
                  style="display:flex; gap:10px;" th:if="${!task.frozen}">
              <select name="status" class="status-dropdown">
                <option value="PENDING" th:selected="${task.status.name() == 'PENDING'}">Pending</option>
                <option value="IN_PROGRESS" th:selected="${task.status.name() == 'IN_PROGRESS'}">In Progress</option>
                <option value="COMPLETED" th:selected="${task.status.name() == 'COMPLETED'}">Completed</option>
              </select>
              <button type="submit" class="update-btn"><i class="fas fa-sync-alt"></i> Update</button>
            </form>
            <div th:if="${task.frozen}">
              <span style="color:#ef4444; font-weight:bold;"><i class="fas fa-lock"></i> Frozen</span>
            </div>
          </div>
        </div>

        <!-- Freeze Toggle -->
        <div class="meta-item">
          <div class="meta-label"><i class="fas fa-snowflake"></i> Freeze Control</div>
          <div class="meta-value">
            <form th:action="@{'/admin/tasks/' + ${task.id} + '/freeze'}" method="post">
              <button type="submit" class="freeze-btn" 
                      th:text="${task.frozen ? 'Unfreeze Task' : 'Freeze Task'}"></button>
            </form>
          </div>
        </div>

        <!-- Dates -->
        <div class="meta-item"><div class="meta-label"><i class="fas fa-calendar-plus"></i> Start Date</div><div class="meta-value" th:text="${#temporals.format(task.startDate,'MMM dd, yyyy')}"></div></div>
        <div class="meta-item"><div class="meta-label"><i class="fas fa-calendar-check"></i> Due Date</div><div class="meta-value" th:text="${#temporals.format(task.dueDate,'MMM dd, yyyy')}"></div></div>
      </div>

      <!-- Delete / Restore -->
      <div style="margin-top:20px;">
        <form th:if="${!task.deleted}" 
              th:action="@{'/admin/tasks/' + ${task.id} + '/delete'}" 
              method="post" 
              onsubmit="return confirm('Are you sure you want to soft delete this task?');">
          <button type="submit" class="delete-btn"><i class="fas fa-trash"></i> Soft Delete Task</button>
        </form>

        <form th:if="${task.deleted}" 
              th:action="@{'/admin/tasks/' + ${task.id} + '/restore'}" 
              method="post" 
              onsubmit="return confirm('Do you want to restore this task?');">
          <button type="submit" class="restore-btn"><i class="fas fa-undo"></i> Restore Task</button>
        </form>
      </div>
    </div>

    <!-- Description -->
    <div class="description" th:if="${task.description != null and !#strings.isEmpty(task.description)}">
      <h2 class="meta-label"><i class="fas fa-align-left"></i> Description</h2>
      <p th:text="${task.description}">Task description...</p>
    </div>

    <!-- Activity Log -->
    <div class="activity-section">
      <h2 class="meta-label"><i class="fas fa-history"></i> Activity Log</h2>
      <div th:each="a : ${activities}" class="activity-item">
        <div class="activity-header">
          <span class="author" th:text="${a.performedBy != null ? a.performedBy.username : 'System'}">User</span>
          <span class="activity-time" th:text="${#temporals.format(a.createdAt,'MMM dd, yyyy HH:mm')}">Time</span>
        </div>
        <div class="activity-content">
          <span th:text="${a.action}"></span> →
          <span th:text="${a.details}"></span>
        </div>
      </div>
      <p class="no-activities" th:if="${activities == null or activities.empty}">
        <i class="fas fa-clock"></i> No activity yet.
      </p>
    </div>

    <!-- Comments -->
    <div class="comments-section">
      <h2 class="meta-label"><i class="fas fa-comments"></i> Comments</h2>
      <div th:each="c : ${comments}" class="comment-item">
        <div class="comment-header">
          <span class="author" th:text="${c.author.username}">User</span>
          <span class="comment-time" th:text="${#temporals.format(c.createdAt,'MMM dd, yyyy HH:mm')}">Time</span>
        </div>
        <div class="comment-content" th:text="${c.content}">Comment</div>
      </div>
      <p class="no-comments" th:if="${comments == null or comments.empty}">
        <i class="fas fa-comment-slash"></i> No comments yet.
      </p>

      <!-- Add Comment -->
      <form th:action="@{'/admin/tasks/' + ${task.id} + '/comments'}" method="post" 
            class="comment-form" th:if="${!task.frozen}">
        <input type="text" name="content" class="comment-input" placeholder="Write a comment..." required>
        <button type="submit" class="comment-btn"><i class="fas fa-paper-plane"></i> Post</button>
      </form>
      <div th:if="${task.frozen}" style="color:#ef4444; font-weight:bold; margin-top:10px;">
        <i class="fas fa-lock"></i> Comments are disabled (Task Frozen)
      </div>
    </div>
  </main>
</div>

<footer><p>© 2025 WorkNest Admin - Powered by Excellence</p></footer>
</body>
</html>
