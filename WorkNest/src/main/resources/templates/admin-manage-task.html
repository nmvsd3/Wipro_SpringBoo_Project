<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Manage Tasks</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body { font-family: 'Inter', sans-serif; background: #f8fafc; color: #334155; line-height: 1.6; }

    header {
      background: linear-gradient(135deg, #1e293b, #334155);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #f59e0b);
      background-size: 300% 100%;
      animation: gradientMove 3s ease infinite;
    }

    @keyframes gradientMove {
      0%,100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    header h2 { font-size: 28px; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

    .container { display: flex; min-height: calc(100vh - 140px); }

    nav.sidebar {
      width: 280px; background: linear-gradient(180deg, #1e293b, #334155); color: white;
      padding: 30px 0; box-shadow: 4px 0 20px rgba(0,0,0,0.1); position: relative;
    }
    nav.sidebar::after { content: ''; position: absolute; top: 0; right: 0; width: 1px; height: 100%;
      background: linear-gradient(180deg, transparent, rgba(255,255,255,0.1), transparent);
    }
    .sidebar-header { padding: 0 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
    .sidebar-header h3 { color: #94a3b8; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    nav.sidebar a {
      display: flex; align-items: center; color: #cbd5e1; text-decoration: none;
      margin: 5px 15px; padding: 15px 20px; border-radius: 12px;
      transition: all 0.3s ease; position: relative; overflow: hidden; font-weight: 500;
    }
    nav.sidebar a::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s;
    }
    nav.sidebar a:hover::before { left: 100%; }
    nav.sidebar a:hover { background: rgba(255,255,255,0.1); color: white; transform: translateX(5px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    nav.sidebar a.active { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; box-shadow: 0 4px 15px rgba(59,130,246,0.3); }
    nav.sidebar a i { margin-right: 12px; width: 20px; text-align: center; font-size: 16px; }

    main { flex: 1; padding: 30px; background: #f8fafc; }
    main h3 { font-size: 32px; font-weight: 700; color: #1e293b; margin-bottom: 30px; position: relative; }
    main h3::after { content: ''; position: absolute; bottom: -8px; left: 0; width: 60px; height: 4px; background: linear-gradient(90deg, #3b82f6, #8b5cf6); border-radius: 2px; }

    .form-container {
      background: white; border-radius: 20px; padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; max-width: 800px;
      opacity: 0; transform: translateY(20px); transition: all 0.6s ease;
    }

    .form-group { margin-bottom: 25px; position: relative; }
    .form-group label { display: block; margin-bottom: 8px; color: #374151; font-weight: 600; font-size: 14px; }
    .form-group label i { margin-right: 8px; color: #3b82f6; width: 16px; }

    .form-group input, .form-group textarea, .form-group select {
      width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px;
      font-size: 16px; transition: all 0.3s ease; background: white; color: #374151;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); transform: translateY(-1px);
    }
    .form-group textarea { resize: vertical; min-height: 100px; }

    .date-group { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

    /* ✅ Multi-select styling */
    .multi-select-container { position: relative; }
    .multi-select {
      border: 2px solid #e5e7eb; border-radius: 12px; background: white; min-height: 50px;
      padding: 8px; cursor: pointer; transition: all 0.3s ease;
    }
    .multi-select:hover { border-color: #3b82f6; }
    .multi-select.open { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .selected-items { display: flex; flex-wrap: wrap; gap: 8px; min-height: 34px; align-items: center; }
    .selected-item {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 6px 12px;
      border-radius: 20px; font-size: 14px; display: flex; align-items: center; gap: 6px;
    }
    .selected-item .remove { cursor: pointer; font-size: 12px; opacity: 0.8; }
    .selected-item .remove:hover { opacity: 1; }
    .placeholder { color: #9ca3af; font-size: 16px; }
    .dropdown {
      position: absolute; top: 100%; left: 0; right: 0; background: white;
      border: 2px solid #e5e7eb; border-top: none; border-radius: 0 0 12px 12px;
      max-height: 200px; overflow-y: auto; z-index: 1000; display: none;
    }
    .dropdown.show { display: block; }
    .dropdown-item { padding: 12px 16px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
    .dropdown-item:hover { background: #f3f4f6; }

    .submit-btn {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white;
      border: none; padding: 16px 32px; border-radius: 12px; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;
      display: flex; align-items: center; gap: 10px; margin-top: 20px;
    }
    .submit-btn::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s;
    }
    .submit-btn:hover::before { left: 100%; }
    .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(59,130,246,0.3); }
    .submit-btn:active { transform: translateY(0); }

    .submit-btn.loading { opacity: 0.8; cursor: not-allowed; }
    .submit-btn .spinner {
      display: none; width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite;
    }
    .submit-btn.loading .spinner { display: block; }

    @keyframes spin { to { transform: rotate(360deg); } }

    footer { background: linear-gradient(135deg, #1e293b, #334155); color: #94a3b8; padding: 20px; text-align: center; border-top: 1px solid #334155; }
    footer p { margin: 0; font-size: 14px; }

    @media (max-width: 768px) {
      .container { flex-direction: column; }
      nav.sidebar { width: 100%; min-height: auto; }
      main { padding: 20px; }
      .form-container { padding: 20px; }
      .date-group { grid-template-columns: 1fr; }
      main h3 { font-size: 24px; }
    }
  </style>
</head>
<body>
<header>
  <h2><i class="fas fa-shield-alt"></i> Admin Panel</h2>
</header>

<div class="container">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header"><h3>Navigation</h3></div>
    <a th:href="@{/admin/dashboard}"><i class="fas fa-tachometer-alt"></i>Dashboard</a>
    <a th:href="@{/admin/manage-task}" class="active"><i class="fas fa-tasks"></i>Manage Tasks</a>
    <a th:href="@{/admin/tasks}"><i class="fas fa-list-check"></i>Tasks</a>
    <a th:href="@{/admin/manage-user}"><i class="fas fa-users-cog"></i>Manage Users</a>
    <a th:href="@{/admin/users}"><i class="fas fa-users"></i>Users</a>
    <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i>Logout</a>
  </nav>

  <!-- Main -->
  <main>
    <h3>Create New Task</h3>
    <div class="form-container">
      <form th:action="@{/admin/tasks}" method="post" id="taskForm">
        <div class="form-group">
          <label for="title"><i class="fas fa-heading"></i> Task Title</label>
          <input type="text" id="title" name="title" placeholder="Enter task title" required>
        </div>

        <div class="form-group">
          <label for="description"><i class="fas fa-align-left"></i> Description</label>
          <textarea id="description" name="description" placeholder="Enter task description (optional)"></textarea>
        </div>

        <!-- ✅ Custom Multi-select -->
        <div class="form-group">
          <label><i class="fas fa-users"></i> Assign to Users</label>
          <div class="multi-select-container">
            <div class="multi-select" id="multiSelect">
              <div class="selected-items" id="selectedItems">
                <span class="placeholder">Select users to assign this task</span>
              </div>
            </div>
            <div class="dropdown" id="dropdown">
              <div th:each="u : ${users}" class="dropdown-item" th:data-value="${u.id}" th:data-text="${u.username}">
                <input type="checkbox" th:id="'user_' + ${u.id}">
                <label th:for="'user_' + ${u.id}" th:text="${u.username}"></label>
              </div>
            </div>
            <select name="assigneeIds" multiple hidden id="hiddenSelect">
              <option th:each="u : ${users}" th:value="${u.id}" th:text="${u.username}"></option>
            </select>
          </div>
        </div>

        <div class="date-group">
          <div class="form-group">
            <label for="startDate"><i class="fas fa-calendar-plus"></i> Start Date</label>
            <input type="date" id="startDate" name="startDate" required>
          </div>
          <div class="form-group">
            <label for="dueDate"><i class="fas fa-calendar-check"></i> Due Date</label>
            <input type="date" id="dueDate" name="dueDate" required>
          </div>
        </div>

        <!-- ✅ Freeze option -->
        <div class="form-group">
          <label><i class="fas fa-lock"></i> Freeze Task?</label>
          <input type="checkbox" name="frozen" value="true"> Yes, freeze this task immediately
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          <i class="fas fa-plus-circle"></i>
          <span>Create Task</span>
          <div class="spinner"></div>
        </button>
      </form>
    </div>
  </main>
</div>

<footer>
  <p><i class="fas fa-copyright"></i> 2025 WorkNest Admin - Powered by Excellence</p>
</footer>

<script>
  // Multi-select functionality
  const multiSelect = document.getElementById('multiSelect');
  const dropdown = document.getElementById('dropdown');
  const selectedItems = document.getElementById('selectedItems');
  const hiddenSelect = document.getElementById('hiddenSelect');
  const placeholder = selectedItems.querySelector('.placeholder');
  const form = document.getElementById('taskForm');
  const submitBtn = document.getElementById('submitBtn');

  let selectedUsers = [];

  multiSelect.addEventListener('click', function() {
    dropdown.classList.toggle('show');
    multiSelect.classList.toggle('open');
  });

  document.addEventListener('click', function(e) {
    if (!multiSelect.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.classList.remove('show');
      multiSelect.classList.remove('open');
    }
  });

  dropdown.addEventListener('change', function(e) {
    if (e.target.type === 'checkbox') {
      const item = e.target.closest('.dropdown-item');
      const userId = item.dataset.value;
      const userName = item.dataset.text;

      if (e.target.checked) {
        addSelectedUser(userId, userName);
      } else {
        removeSelectedUser(userId);
      }
      updateHiddenSelect();
    }
  });

  function addSelectedUser(userId, userName) {
    if (!selectedUsers.find(user => user.id === userId)) {
      selectedUsers.push({ id: userId, name: userName });
      renderSelectedUsers();
    }
  }

  function removeSelectedUser(userId) {
    selectedUsers = selectedUsers.filter(user => user.id !== userId);
    const checkbox = document.querySelector(`#user_${userId}`);
    if (checkbox) checkbox.checked = false;
    renderSelectedUsers();
    updateHiddenSelect();
  }

  function renderSelectedUsers() {
    selectedItems.innerHTML = '';
    if (selectedUsers.length === 0) {
      selectedItems.appendChild(placeholder);
    } else {
      selectedUsers.forEach(user => {
        const item = document.createElement('div');
        item.className = 'selected-item';
        item.innerHTML = `${user.name} <span class="remove" onclick="removeSelectedUser('${user.id}')">&times;</span>`;
        selectedItems.appendChild(item);
      });
    }
  }

  function updateHiddenSelect() {
    Array.from(hiddenSelect.options).forEach(option => {
      option.selected = selectedUsers.some(user => user.id === option.value);
    });
  }

  // Add loading state on form submit
  form.addEventListener('submit', function(e) {
    const title = document.getElementById('title').value;
    const startDate = document.getElementById('startDate').value;
    const dueDate = document.getElementById('dueDate').value;

    if (!title || !startDate || !dueDate) {
      e.preventDefault();
      alert('Please fill in all required fields.');
      return;
    }

    if (new Date(dueDate) < new Date(startDate)) {
      e.preventDefault();
      alert('Due Date cannot be earlier than Start Date.');
      return;
    }

    submitBtn.classList.add('loading');
    submitBtn.querySelector('span').textContent = 'Creating Task...';
    submitBtn.disabled = true;
  });

  //  Set minimum date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('startDate').min = today;
  document.getElementById('dueDate').min = today;

  document.getElementById('startDate').addEventListener('change', function() {
    document.getElementById('dueDate').min = this.value;
  });

  //  Form fade-in animation
  document.addEventListener('DOMContentLoaded', function() {
    const formContainer = document.querySelector('.form-container');
    setTimeout(() => {
      formContainer.style.opacity = '1';
      formContainer.style.transform = 'translateY(0)';
    }, 100);
  });
</script>
</body>
</html>
